// ==========================================================================
// Project:   Ember Validations
// Copyright: ©2012 Louis Coquio and contributors
//            Portions ©2006-2011 Strobe Inc.
// License:   Licensed under MIT license (see license.js)
// ==========================================================================

(function(){var a=Ember.get,b=Ember.set;Ember.ValidationError=Ember.Object.extend({key:null,customMessage:null,messageFormat:null,message:Ember.computed(function(){var b=a(this,"customMessage")||Ember.ValidationError.getMessage(a(this,"key")),c=a(this,"messageFormat");Ember.assert("no message are defined for key: "+a(this,"key"),b);if(c)for(var d in c){if(!c.hasOwnProperty(d))continue;var e=new RegExp("@{"+d+"}");b.match(e)&&(b=b.replace(e,c[d]))}return b}).property("key","customMessage").cacheable()}),Ember.ValidationError.reopenClass({messages:{},addMessage:function(a,b){this.messages[a]=b},addMessages:function(b){var c=a(this,"addMessage");for(var d in b){if(!b.hasOwnProperty(d))continue;this.addMessage(d,b[d])}},getMessage:function(a){return this.messages[a]}})})(),function(){var a=Ember.get,b=Ember.set;Ember.ValidationErrors=Ember.Object.extend({_nestedErrors:null,_content:null,init:function(){this._super(),this._resetErrors()},allKeys:Ember.computed(function(){return this._allErrorsData("keys")}).property("length").cacheable(),allMessages:Ember.computed(function(){return this._allErrorsData("messages")}).property("length").cacheable(),fullMessages:Ember.computed(function(){return a(this,"allMessages").map(function(a){var b=a[0];return a[0]!==""&&(b+=" "),b+=a[1],b})}).property("allMessages").cacheable(),keys:Ember.computed(function(){var b=a(this,"_content"),c=Ember.A();return b.forEach(function(a){c.push(a.get("key"))}),c}).property("length").cacheable(),messages:Ember.computed(function(){var b=a(this,"_content"),c=Ember.A();return b.forEach(function(a){c.push(a.get("message"))}),c}).property("length").cacheable(),length:Ember.computed(function(){var b=0,c=a(this,"_content"),d=a(this,"_nestedErrors");return b+=c.length,d.forEach(function(c,d){b+=a(d,"length")}),b}).cacheable(),unknownProperty:function(b){var c=a(this,"_nestedErrors");return c.get(b)},add:function(b,c,d,e){this.propertyWillChange("length");if(!b){var f=Ember.ValidationError.create({key:c,customMessage:e,messageFormat:d});a(this,"_content").pushObject(f)}else{var g=this._pathsForAttribute(b),h=this._getOrCreateNestedErrors(g.path);h.add(g.nestedPath,c,d,e)}this.propertyDidChange("length")},remove:function(b){this.propertyWillChange("length");if(!b)this._resetErrors();else{var c=a(this,"_nestedErrors"),d=this._pathsForAttribute(b),e=c.get(d.path);e&&e.remove(d.nestedPath)}this.propertyDidChange("length")},clear:function(){this.propertyWillChange("length"),this._resetErrors(),this.propertyDidChange("length")},_getOrCreateNestedErrors:function(b){var c=a(this,"_nestedErrors"),d=c.get(b);return d||(d=Ember.ValidationErrors.create(),c.set(b,d)),d},_pathsForAttribute:function(a){var b=Ember.A(a.split("."));return{path:b[0],nestedPath:b.removeAt(0).join(".")}},_resetErrors:function(){b(this,"_content",Ember.A()),b(this,"_nestedErrors",Ember.Map.create())},_allErrorsData:function(b){var c=a(this,b),d=Ember.A();c.forEach(function(a){d.push(["",a])});var e=a(this,"_nestedErrors");return e.forEach(function(a,c){var e="all"+b[0].toUpperCase()+b.slice(1),f=c.get(e);f.forEach(function(b){var c=a;b[0]!==""&&(c+="."+b[0]),d.push([c,b[1]])})}),d}})}(),function(){var a=Ember.get,b=Ember.set;Ember.Validations=Ember.Mixin.create({init:function(){this._super(),a(this,"validationErrors")===undefined&&b(this,"validationErrors",Ember.ValidationErrors.create())},validate:function(){var b=a(this,"validations"),c=a(this,"validationErrors");this.propertyWillChange("validationErrors"),c.clear();for(var d in b){if(!b.hasOwnProperty(d))continue;this._validateProperty(d)}return this.propertyDidChange("validationErrors"),a(this,"isValid")},validateProperty:function(a){this.propertyWillChange("validationErrors");var b=this._validateProperty(a);return this.propertyDidChange("validationErrors"),b},_validateProperty:function(b){var c=a(this,"validations"),d=a(this,"validationErrors");d.remove(b);var e=c[b];for(var f in e){if(!e.hasOwnProperty(f))continue;var g=e[f],h=Ember.Validators.getValidator(f,g);h.validate(this,b,this.get(b))}var i=!a(this,"validationErrors."+b+".length");return i},isValid:Ember.computed(function(){return a(this,"validationErrors.length")===0}).property("validationErrors.length").cacheable()})}(),function(){Ember.Validators=Ember.Namespace.create({getValidator:function(a,b){var c=null,d=b;typeof b=="object"&&b.validator&&(Ember.Validator.detect(b.validator)?c=b.validator.create():typeof b["validator"]=="function"&&(c=Ember.Validator.create(),c.set("validate",b.validator)),c&&b.options&&(d=b.options));if(!c){var e=a.charAt(0).toUpperCase()+a.substring(1)+"Validator";Ember.Validator.detect(this[e])&&(c=this[e].create())}if(!c)throw new Error("Validator not found for name '"+a+"'.");return Ember.typeOf(d)!=="object"&&(d={value:d}),c.set("options",d),c}})}(),function(){Ember.Validator=Ember.Object.extend({init:function(){this._super(),this.hasOwnProperty("options")||this.set("options",{}),this.checkValidity&&this.checkValidity()},validate:function(a,b,c){if(this.shouldSkipValidations(a,b,c))return!1;this._validate(a,b,c)},shouldSkipValidations:function(a,b,c){var d=Ember.get(this,"options");return d.allowBlank===!0?c===""||c===null||c===undefined:!1},_validate:function(a,b,c){throw new Error("Ember.Validator subclasses should implement _validate() method.")},optionValue:function(a,b,c){var d=this.get("options."+b);return typeof d=="function"&&(d=d.apply(a)),!c||typeof c=="string"&&typeof d===c?d:c===undefined?d:null}})}(),function(){Ember.ValidationError.addMessage("blank","can't be blank"),Ember.Validators.PresenceValidator=Ember.Validator.extend({shouldSkipValidations:function(a,b,c){return!1},_validate:function(a,b,c){var d=Ember.A([undefined,null]);(d.contains(c)||c.match&&c.match(/^\s*$/))&&a.get("validationErrors").add(b,"blank")}})}(),function(){var a=Ember.get;Ember.ValidationError.addMessages({notNumber:"is not a number",notInteger:"is not an integer",notGreaterThan:"is not greater than @{value}",notGreaterThanOrEqualTo:"is not greater than or equal to @{value}",notLessThan:"is not less than @{value}",notLessThanOrEqualTo:"is not less than or equal to @{value}",notEqual:"is not equal to @{value}"}),Ember.Validators.NumericalityValidator=Ember.Validator.extend({_validate:function(b,c,d){var e=parseFloat(d),f=parseInt(d,10),g=a(b,"validationErrors");if(isNaN(d)||isNaN(e))g.add(c,"notNumber");else{var h=a(this,"options");h.onlyInteger===!0&&e!==f&&g.add(c,"notInteger");var i;i=this.optionValue(b,"greaterThan","number"),i!==null&&e<=i&&g.add(c,"notGreaterThan",{value:i}),i=this.optionValue(b,"greaterThanOrEqualTo","number"),i!==null&&e<i&&g.add(c,"notGreaterThanOrEqualTo",{value:i}),i=this.optionValue(b,"lessThan","number"),i!==null&&e>=i&&g.add(c,"notLessThan",{value:i}),i=this.optionValue(b,"lessThanOrEqualTo","number"),i!==null&&e>i&&g.add(c,"notLessThanOrEqualTo",{value:i}),i=this.optionValue(b,"equalTo","number"),i!==null&&e!==i&&g.add(c,"notEqual",{value:i})}},isValidForOption:function(a,b,c){var d=this.optionValue(b);return d!==null&&c.apply(a,d)}})}(),function(){var a=Ember.get;Ember.ValidationError.addMessages({tooShortLength:"is too short (minimum @{value} characters)",tooLongLength:"is too long (maximum @{value} characters)",wrongLength:"is the wrong length (should be @{value} characters)"}),Ember.Validators.LengthValidator=Ember.Validator.extend({_validate:function(b,c,d){var e=a(this,"options"),f=a(b,"validationErrors"),g=d?Ember.get(d,"length"):0,h;h=this.optionValue(b,"is","number"),h===null&&(h=this.optionValue(b,"value","number")),h!==null?g!==h&&f.add(c,"wrongLength",{value:h}):(h=this.optionValue(b,"minimum","number"),h!==null&&g<h&&f.add(c,"tooShortLength",{value:h}),h=this.optionValue(b,"maximum","number"),h!==null&&g>h&&f.add(c,"tooLongLength",{value:h}))}})}(),function(){var a=Ember.get;Ember.ValidationError.addMessages({invalid:"is invalid"}),Ember.Validators.FormatValidator=Ember.Validator.extend({_validate:function(b,c,d){var e=a(this,"options"),f=a(b,"validationErrors"),g;if(!d||typeof d.match!="function")d="";g=this.optionValue(b,"with")||this.optionValue(b,"value"),(typeof g=="string"||g instanceof RegExp)&&!d.match(g)&&f.add(c,"invalid"),g=this.optionValue(b,"without"),(typeof g=="string"||g instanceof RegExp)&&d.match(g)&&f.add(c,"invalid")}})}(),function(){var a=Ember.get;Ember.ValidationError.addMessages({match:"fields do not match"}),Ember.Validators.MatchValidator=Ember.Validator.extend({_validate:function(b,c,d){var e=a(this,"options")||{};e.property&&b.get(e.property)!==d&&b.get("validationErrors").add(c,"match")}})}(),function(){}()